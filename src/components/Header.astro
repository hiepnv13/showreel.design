---
// Header component matching Figma design
import { getAllCategories, generateSlug } from "../utils/videoUtils";

// Props for showing video counts
interface Props {
  showingCount?: number;  // Number of videos showing on current page
  totalCount?: number;    // Total number of videos in collection/category
}

const { showingCount, totalCount } = Astro.props;

// Get current path to highlight active category
const currentPath = Astro.url.pathname;

// Get all categories dynamically
const allCategories = await getAllCategories();

// Build category buttons data
const categoryButtons = [
  { label: 'ALL', slug: '/', active: currentPath === '/' || currentPath.startsWith('/page/') }
];

// Add dynamic categories
for (const category of allCategories) {
  const slug = generateSlug(category);
  const isActive = currentPath.includes(`/category/${slug}`);
  categoryButtons.push({
    label: category,
    slug: `/category/${slug}`,
    active: isActive
  });
}
---

<header class="w-full bg-white sticky top-0 z-50 px-8 pt-8 pb-4 flex flex-col gap-6">
  <!-- Top Row: Logo, Filters, Search -->
  <div class="flex items-center justify-between w-full">
    <!-- Logo -->
    <div class="pr-12 flex-shrink-0">
      <a href="/" class="text-[30px] font-medium tracking-[-1.5px] text-[#1a1a1a] hover:opacity-70 transition-opacity whitespace-nowrap">
        Showreel.design
      </a>
    </div>

    <!-- Category Filter Buttons -->
    <div class="flex items-center gap-2">
      {categoryButtons.map((cat) => (
        <a
          href={cat.slug}
          class={`filter-btn ${cat.active ? 'active' : ''}`}
        >
          {cat.label}
        </a>
      ))}
    </div>

    <!-- Search Bar -->
    <div class="pl-10 flex-shrink-0" id="search-container">
      <form action="/search" method="get" class="border-b border-gray-200 pb-2 flex items-center gap-4">
        <input
          type="text"
          name="q"
          id="search-input"
          placeholder="Search showreel"
          class="w-[180px] bg-transparent border-none outline-none text-[14px] placeholder-gray-500"
          autocomplete="off"
        />
        <div class="bg-[#f0f0f0] px-2 py-1 rounded text-[12px] text-gray-500 border border-transparent">
          ENTER
        </div>
      </form>

      <!-- Search Suggestions Dropdown -->
      <div id="search-suggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg mt-1 max-h-96 overflow-y-auto z-50 hidden">
        <div id="suggestions-content" class="py-2">
          <!-- Suggestions will be populated by JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <!-- Results Counter -->
  <div class="w-full flex items-center">
    <span class="text-[10px] tracking-[1.5px] text-gray-500 font-medium flex items-center gap-1 uppercase" id="results-counter">
      Showing <span id="showing-count">{showingCount || 0}</span> <i class="fa-solid fa-caret-right text-[8px] mx-0.5 text-gray-400"></i> of <span id="total-count">{totalCount?.toLocaleString() || 0}</span>
    </span>
  </div>
</header>

<style>
  /* Search suggestions styling */
  #search-suggestions {
    z-index: 9999;
  }

  .suggestion-item:hover {
    background-color: #f9fafb;
  }

  .suggestion-item.bg-gray-100 {
    background-color: #f3f4f6;
  }

  /* Ensure search container has proper stacking context */
  #search-container {
    position: relative;
    z-index: 100;
  }
</style>

<script>
  // Import search handler for search functionality
  import '../scripts/searchHandler.js';
</script>
