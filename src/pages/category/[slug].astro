---
import { getCollection, type CollectionEntry } from "astro:content";
import {
    getVideosByCategorySlug,
    getAllCategories,
    sortVideosByDate,
    generateSlug,
} from "../../utils/videoUtils";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import VideoGrid from "../../components/VideoGrid.astro";
import type { GetStaticPaths } from "astro";

export const getStaticPaths: GetStaticPaths = async () => {
    const categories = await getAllCategories();
    return categories.map((category: string) => ({
        params: { slug: generateSlug(category) },
        props: { category, categorySlug: generateSlug(category) },
    }));
};

interface Props {
    category: string;
    categorySlug: string;
}

const { category, categorySlug }: Props = Astro.props;

// Get videos for this category
const allVideos = await getVideosByCategorySlug(categorySlug);
const videos = sortVideosByDate(allVideos);
const itemsPerPage = 24;
const totalPages = Math.ceil(videos.length / itemsPerPage);

// Calculate counts for header
const totalCount = videos.length;
const showingCount = Math.min(itemsPerPage, totalCount);

// Get all categories for breadcrumb/navigation
const allCategories = await getAllCategories();
---

<Layout title={`${category} Videos - Showreel.design`}>
    <Header showingCount={showingCount} totalCount={totalCount} />
    <main>
        

        <!-- Use VideoGrid Component -->
        <VideoGrid
            videos={videos}
            currentCategory={category}
            showAllTab={true}
            currentPage={1}
            itemsPerPage={itemsPerPage}
            baseUrl={`/category/${categorySlug}`}
        />

        <!-- Empty State (only show if no videos in this category) -->
        {
            videos.length === 0 && (
                <section class="py-20 bg-gray-50">
                    <div class="section-container">
                        <div class="text-center py-16">
                            <div class="text-gray-400 text-6xl mb-4">ðŸŽ¬</div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-2">
                                No videos found
                            </h3>
                            <p class="text-gray-600 mb-8">
                                There are no videos in the {category} category
                                yet.
                            </p>
                            <a href="/" class="btn-primary">
                                Browse All Videos
                            </a>
                        </div>
                    </div>
                </section>
            )
        }
    </main>
</Layout>